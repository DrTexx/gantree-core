- hosts: all
  gather_facts: false
  strategy: free
  tasks:
  - name: wait for machine and ssh
    wait_for_connection:
      timeout: 900
      sleep: 10
    retries: 20

- hosts: all
  roles: gropius-env
  become: yes

- hosts: master-validator
  roles:
  - substrate-build-node
  become: yes

- hosts: all
  strategy: free
  roles:
  - validator-push-bin
  become: yes

- hosts: master-validator
  roles:
  - substrate-build-spec
  become: yes

- hosts: all
  roles:
  - validator-push-spec
  become: yes

- hosts: all
  strategy: free
  roles:
  - substrate-common
  - role: node-exporter
    when: "node_exporter_enabled|default(false)|bool == true"
  become: yes

- hosts: all
  roles:
  - common
  become: yes

- hosts: validator
  roles:
  - substrate-validator
  - substrate-validator-session-info
  become: yes

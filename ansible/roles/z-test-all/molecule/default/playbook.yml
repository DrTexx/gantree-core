---
- hosts: all
  gather_facts: false
  strategy: free
  tasks:
  - name: wait for machine and ssh
    wait_for_connection:
      timeout: 5
      sleep: 2
    retries: 3

- hosts: validator
  roles:
    - validator-env-gantree
  become: yes

- hosts: builder_bin
  roles:
    - builder-build-bin
  become: yes

- hosts: validator
  strategy: free
  roles:
    - validator-push-bin
  become: yes

- hosts: localhost
  roles:
    - control-prepare

- hosts: validator
  roles:
    - validator-gen-keys

- hosts: builder_bin
  roles:
    - builder-build-spec

- hosts: builder_bin
  roles:
    - bootnode-collect-ip

- hosts: validator
  roles:
    - validator-push-spec

- hosts: validator
  roles:
    - validator-service

- hosts: validator
  roles:
    - validator-key-insert

- hosts: validator
  roles:
    - validator-service-restart